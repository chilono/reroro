# RERORO

一款在夜神模拟器上的明日方舟自动刷图脚本

* 脚本采用opencv进行图色识别
* 使用json读取`config.json`获取待刷帐号信息
* 个人使用构建在夜神模拟器上，但如有需要，修改一些参数或许也可以使用别的模拟器替换
* 脚本初衷为个人长草期代肝使用，缺陷很多，大量帐号代肝无能为力，并且若网络波动使游戏一直处于加载中时，脚本没有智能重开功能。
* 公开招募模块暂时有缺陷，可能会把您的`高资`给当作没有用的标签，因为我还没收集到高资的原图，无法进行识别。其他暂缺标签图片：`控场，爆发，支援机械`
* 因为用于模板匹配判断的原图都是在`1600x900`的分辨率下截取的，所以基本只能在`1600x900`分辨率下正常运行

## 如何使用

1. 环境准备

   * python3
     * opencv-python
     * numpy
     * json库
   * 夜神模拟器
     * 默认使用该模拟器，别的模拟器需要修改一些代码，因为代码凌乱，所以不太推荐
     * 在模拟器上安装明日方舟，分辨率设置为1600x900，将帐号登录一遍，将游戏设置中离开基建的提示关闭。

2. 修改代码中的模拟器adb路径与模拟器命令行工具

   * 打开`reroro.py`

   * 模拟器adb： `nox_adb_path`
     * 改为你安装模拟器的adb的路径，一般夜神的路径是`<你选择的安装路径>\Nox\bin\nox_adb.exe`
   * 模拟器命令行工具：`nox_con_path`
     * 同上，修改成你的模拟器的命令行工具，因为我只使用夜神，所以不确定其他模拟器使用可行

3. 编写你的`config.json`

  ```json
{
    "w": {	# 这个配置的名字，随你起，只要方便你记忆
        "name": "w",  # 模拟器的名称，打开模拟器左上角的那个名字，可以在模拟器中修改，但要对应上，用于到点自动开启模拟器
        "device": " -s 127.0.0.1:62025 ",  # 模拟器的adb地址，夜神的算法是0号对应62021,1号往后的都是62024+号数，例如1号是'62024+1=62025'，2号是'62024+2=62026
        "tier": 4,  # 基建的层数，指地下的层数，地上的层数不算，最高4层，第4层是单个宿舍，在基建自动收获替换干员中使用
        "acceler": true,  # 自动电量加速功能'true'为开启，'false'为关闭，默认加速地下1层中间的制造站，如地下1层中间的不是制造站，会出问题。贸易站无法加速。
        "types": "number",  # 为下方自动刷图的次数计算方式,'number'是次数，'reason'是理智计数，建议使用次数，理智计数暂时不完善
        "levels": {  # 每周每日关卡字典，数字代表星期几，星期天是0。am表示上午，pm表示下午，上午默认是4点到17点，下午默认是18点到次日4点。
          # 主线关卡直接填写数字例如 '4-4':10,表示刷10次4-4。
          # 主线关卡中带S的关卡卸载关卡末尾，如关卡s3-4则需要填写为'3-4s':20的格式
          # 资源收集关卡直接填写即可，如钱本5，'ce-5':5。碳关卡，'sk-5':10。经验本，'ls-5':30
          # 芯片关卡也直接填写关卡号即可，如，'pr-b-2':8，'pr-c-1':4，'pr-d-2':30
          # 剿灭作战因为没有编号，使用拼音，如，'jm-1':4
          # 活动关卡咱不支持
          # 下列均为模板，需根据实际需要修改
            "1": {
                "am": {
                    "jm-1": 3
                },
                "pm": {
                    "jm-1": 4,
                    "1-8": 3
                }
            },
            "2": {
                "am": {
                    "1-8": 3
                },
                "pm": {}
            },
            "3": {
                "am": {
                    "1-8": 3
                },
                "pm": {}
            },
            "4": {
                "am": {
                    "1-8": 3
                },
                "pm": {}
            },
            "5": {
                "am": {
                    "1-8": 3
                },
                "pm": {}
            },
            "6": {
                "am": {
                    "1-8": 3
                },
                "pm": {}
            },
            "0": {
                "am": {
                    "1-8": 3
                },
                "pm": {}
            }
        },
		# todo字典存储着需要进行的关卡列表，每次完成后会自动计算完成次数在todo中删减。默认在当天固定安排后进行，请按实际进行更改
        "todo": {
            "ce-5": 9989,
            "ls-5": 26,
            "pr-b-2": 12,
            "4-2": 26,
            "3-2": 1,
            "2-9": 18
        },
		# 脚本写入的字典，完成后一轮自动操作后会写入，表达本次的预订目标，无需修改与注意
        "level": {
            "1-8": 3,
            "ce-5": 9992,
            "ls-5": 26,
            "pr-b-2": 12,
            "4-2": 26,
            "3-2": 1,
            "2-9": 18
        },
		# 脚本写入的字典，表示本次自动操作完成了那些关卡，可用于检查本次完成了那些关卡
        "over": {
            "1-8": 3,
            "ce-5": 3,
            "ls-5": 0,
            "pr-b-2": 0,
            "4-2": 0,
            "3-2": 0,
            "2-9": 0
        }
    }
}
  ```

4. (可选)修改每日运行时间
   * 打开`reroro.py`
   * 搜索`修改点4-1`
   * 修改当前行`if time_hour in [6, 7, 8, 18, 19, 20]:`中的列表，列表中为运行的时间点，6点，7点，8点，18点，19点，20点，在这些时间范围都会运行，修改成你要运行的时间点，比如你只要每天4点运行则把列表改为`[4]`，每天8点和20点运行则改为`[8, 20]`
   * 搜索`修改点4-2`
   * 修改该块上午与下午的判断逻辑机制，am是上午，pm是下午，time_ap是存储当前是上午还是下午的变量。需要一点点基础即可自行修改。
   * 搜索`修改点4-3`
   * `修改点4-3`为每次运行完后停止的间隔，防止在连续的时间范围内再次运行，如上方`[6,7,8,18,19,20]`我默认是3个小时的连续时间范围所以保险起见我休眠了`14400`秒等于`4`个小时。根据你的实际需要修改这个秒数。
5. 运行`reroro.py`

## 琐碎的注意事项

* 脚本只会开启代理，不会自动部署干员打关，若代打的关卡无法代理，会出问题，请注意
* 公开招募模块只会识别招募完成按钮，然后对着那块再次招募，所以如果公开招募没有进行中的招募的话，脚本不会自动开启招募
* 信用交易所会从第二个开始购买，不会购买第一个物品，因为会购买到干员，所以觉得这块逻辑比较麻烦就没做。
* 每周的理智合剂不会自动饮用，为防止浪费与过期，请自行使用，珍惜粮食，你我有责。或者在脚本开启前手动饮用。
* 脚本采用使用adb截图，然后取出，在进行图片分析的方式，所以速度比较慢。并且请不要删除文件夹`temp`和`log`，这两个文件夹分辨用于存放从模拟器取出的截图和每日脚本自动工作的图片截图日志。
* `log`文件夹内的log在看完后可以删除，或者你不想看当然可以直接删除，或者你硬盘大，任性，可以都不管，log功能可关闭
  * 搜索`修改点5-1`
  * 将`LOG_MOD`改为`False`即可
* 基建不会根据干员心情替换，只会机械式的替换一遍。

